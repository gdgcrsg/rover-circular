<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<title>CRSG ‡¶≠‡¶∞‡ßç‡¶§‡¶ø ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®</title>
<style>
/* Base Styles */
* { 
  box-sizing: border-box; 
  margin: 0; 
  padding: 0; 
  -webkit-tap-highlight-color: transparent;
  -webkit-text-size-adjust: 100%;
}

body { 
  font-family: "Segoe UI", "Roboto", "Helvetica Neue", sans-serif; 
  background: #eef2f7; 
  color: #1e293b; 
  line-height: 1.5;
  touch-action: manipulation;
  overflow-x: hidden;
}

/* Header */
.header {
  display: flex; 
  flex-wrap: wrap; 
  align-items: center; 
  justify-content: center; 
  gap: 12px;
  padding: 20px 15px; 
  background: linear-gradient(90deg, #0f172a, #1e40af); 
  color: #fff; 
  border-bottom: 5px solid #2563eb; 
  text-align: center;
  animation: headerFade 1.2s ease forwards;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  min-height: 120px;
}

@keyframes headerFade { 
  from { opacity: 0; transform: translateY(-50px); } 
  to { opacity: 1; transform: translateY(0); } 
}

.header .logo { 
  height: 80px; 
  width: 80px; 
  border-radius: 20px; 
  border: 2px solid #1d4ed8; 
  background: linear-gradient(145deg, #fff, #f0f5ff); 
  box-shadow: 0 8px 20px rgba(0,0,0,1.2); 
  transition: transform 0.4s ease, box-shadow 0.4s ease; 
}

.header .logo:hover {
  transform: translate(0px, 32px) rotate(360deg)  scale(2.2); 
  box-shadow: 0 12px 28px rgba(0,0,0,0.50);
}

.header h1 { 
  font-size: clamp(1.2rem, 4vw, 1.6rem); 
  font-weight: 700;
  text-shadow: 0 0 6px #38bdf8; 
  line-height: 1.3;
  margin: 5px 0;
}

.header p { 
  font-size: clamp(0.85rem, 3vw, 1rem); 
  opacity: 0.95; 
  font-style: italic;
  margin: 0;
}

/* Total Applications Badge */
.total-badge {
  display: inline-block;
  background: linear-gradient(135deg, #2563eb, #3b82f6);
  color: #fff;
  font-size: clamp(0.9rem, 3vw, 1rem);
  font-weight: 700;
  padding: 12px 20px;
  border-radius: 25px;
  margin: 15px 0;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  animation: pulse 2s infinite;
  letter-spacing: 0.5px;
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
}

@keyframes pulse {
  0% { transform: scale(1); box-shadow: 0 0 12px rgba(59,130,246,0.5); }
  50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(59,130,246,0.6); }
  100% { transform: scale(1); box-shadow: 0 0 12px rgba(59,130,246,0.5); }
}

/* Controls Container */
.controls-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  margin: 15px 0;
  padding: 0 15px;
}

.controls-row {
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
  max-width: 500px;
  justify-content: center;
}

/* Search Box */
.search-box { 
  width: 100%;
  max-width: 500px;
}

.search-box input {
  width: 100%; 
  padding: 14px 16px; 
  border: 2px solid #2563eb; 
  border-radius: 12px; 
  font-size: 1rem;
  transition: all 0.3s ease;
  background: #fff;
  -webkit-appearance: none;
  min-height: 48px;
}

.search-box input:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 8px rgba(59,130,246,0.4);
}

/* Refresh Button */
#refreshBtn {
  padding: 12px;
  font-size: 1.2rem;
  border: none;
  border-radius: 50%;
  background: linear-gradient(135deg, #7c3aed, #8b5cf6);
  color: #fff;
  cursor: pointer;
  transition: all 0.3s;
  min-width: 48px;
  min-height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
}

#refreshBtn:active {
  transform: scale(0.95);
  background: linear-gradient(135deg, #6d28d9, #7c3aed);
}

/* Cards Container */
.container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
  padding: 20px 15px;
}

.card {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  padding: 20px;
  text-align: center;
  transition: all 0.3s ease;
  cursor: pointer;
  word-wrap: break-word;
  border: 1px solid #e2e8f0;
  position: relative;
  overflow: hidden;
}

.card:hover { 
  transform: translateY(-18px) scale(1.02); 
  box-shadow: 0 14px 28px rgba(0,0,0,0.95); 
}

.card img { 
  width: 150px; 
  height: 150px; 
  border-radius: 50%; 
  object-fit: cover; 
  border: 2px solid #3b82f6; 
  margin-bottom: 0px;
  transition: transform 0.3s ease;
}

.card img:hover { transform: translate(0px, 120px) scale(4.2); box-shadow: 0 6px 18px rgba(59,130,246,0.4); }

.card h3 { 
  margin: 10px 0 8px; 
  font-size: 1.1rem; 
  color: #0f172a; 
  overflow: hidden; 
  text-overflow: ellipsis; 
  white-space: nowrap;
  font-weight: 600;
  line-height: 1.3;
}

.card p { 
  margin: 6px 0; 
  font-size: 0.9rem; 
  color: #334155; 
  line-height: 1.4;
}

.label { 
  font-weight: bold; 
  color: #1e40af; 
  background: rgba(59,130,246,0.1); 
  padding: 2px 6px; 
  border-radius: 4px;
  font-size: 0.85rem;
}

/* Modal - Mobile Optimized */
.modal { 
  display: none; 
  position: fixed; 
  z-index: 1000; 
  left: 0; 
  top: 0; 
  width: 100%; 
  height: 100%; 
  background: rgba(0,0,0,0.7); 
  justify-content: center; 
  align-items: flex-start;
  padding: 10px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

.modal-content { 
  background: #fff; 
  border-radius: 16px; 
  width: 100%; 
  max-width: 95vw;
  padding: 20px; 
  overflow-y: auto; 
  max-height: 85vh; 
  position: relative; 
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  margin: auto;
}

.modal-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  border-bottom: 2px solid #e2e8f0; 
  margin-bottom: 15px; 
  padding-bottom: 10px; 
  position: sticky;
  top: 0;
  background: white;
  z-index: 1;
}

.close { 
  font-size: 2rem; 
  cursor: pointer; 
  font-weight: bold; 
  color: #ef4444; 
  transition: color 0.2s;
  padding: 5px;
  min-width: 44px;
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.close:active { 
  color: #b91c1c; 
  transform: scale(0.9);
}

.modal-actions { 
  display: flex; 
  gap: 10px; 
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.modal-actions button { 
  padding: 12px 16px; 
  font-size: 0.95rem; 
  border: none; 
  border-radius: 8px; 
  cursor: pointer; 
  background: #2563eb; 
  color: #fff; 
  transition: all 0.3s;
  flex: 1;
  min-width: 120px;
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-actions button:active { 
  background: #3b82f6; 
  transform: scale(0.95);
}

/* Table - Mobile Friendly */
.table-container {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

table { 
  width: 100%; 
  border-collapse: collapse; 
  min-width: 300px;
}

th, td { 
  padding: 12px 8px; 
  text-align: left; 
  border-bottom: 1px solid #e2e8f0; 
  word-break: break-word;
}

th { 
  background: #f1f5f9; 
  color: #1e3a8a; 
  width: 35%; 
  font-size: 0.9rem;
  font-weight: 600;
}

td { 
  color: #334155; 
  font-size: 0.9rem;
}

/* Clickable Links in Table */
.clickable-link {
  color: #2563eb;
  text-decoration: none;
  font-weight: 500;
  word-break: break-all;
  display: inline-block;
  padding: 2px 4px;
  border-radius: 4px;
  transition: background-color 0.2s;
}

.clickable-link:active {
  background-color: rgba(37, 99, 235, 0.1);
}

.whatsapp-link {
  color: #25D366 !important;
  font-weight: 600;
}

/* Footer */
.footer { 
  background: #f8fafc; 
  padding: 20px 15px; 
  text-align: center; 
  font-size: 14px; 
  color: #333; 
  border-top: 1px solid #ddd; 
  margin-top: 30px; 
}

.footer a { 
  color: #2563eb; 
  text-decoration: none; 
  font-weight: 500; 
}

.footer a:active { 
  color: #3b82f6; 
}

.developer { 
  margin-top: 15px; 
  display: flex; 
  flex-wrap: wrap; 
  align-items: center; 
  justify-content: center; 
  gap: 12px; 
  font-size: 13px; 
  color: #444; 
}

.developer img { 
  width: 44px; 
  height: 44px; 
  border-radius: 50%; 
  border: 2px solid #3b82f6; 
  object-fit: cover; 
  transition: transform 0.3s ease; 
}

.developer img:hover {
  transform: translate(93px, -337px) scale(7.2);
  box-shadow: 0 6px 18px rgba(59,130,246,0.4);
}

/* Password Screen - Mobile Optimized */
#passwordScreen {
  position: fixed; 
  top:0; 
  left:0; 
  width:100%; 
  height:100%;
  background: linear-gradient(135deg, #0f172a, #1e40af); 
  display:flex; 
  justify-content:center; 
  align-items:center; 
  flex-direction:column; 
  z-index:2000; 
  color:#fff; 
  text-align:center; 
  padding: 20px 15px;
  overflow-y: auto;
}

.password-container {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 25px 20px;
  max-width: 400px;
  width: 100%;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.password-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px;
  background: #e6f2ff;
  border: 2px solid #006400;
  border-radius: 12px;
  margin-bottom: 25px;
  color: #004d00;
}

.password-logo {
  width: 50px;
  height: 50px;
  object-fit: contain;
  border-radius: 8px;
  border: 1px solid #006400;
}

.password-title h1 {
  font-size: 14px;
  font-weight: bold;
  margin: ;
  line-height: 1.3;
}

.password-title p {
  font-size: 5px;
  margin: 2px 0 0 0;
}

#passwordScreen h2 {
  font-size: clamp(1.3rem, 5vw, 1.6rem);
  margin-bottom: 10px;
  text-shadow: 0 0 6px #38bdf8;
  line-height: 1.3;
}

#passwordScreen p {
  font-size: clamp(0.9rem, 4vw, 1.1rem);
  margin-bottom: 15px;
  line-height: 1.4;
}

#passwordScreen input {
  padding: 14px 16px;
  border-radius: 8px;
  border: none;
  margin-bottom: 15px;
  font-size: 1rem;
  width: 100%;
  max-width: 320px;
  background: #fff;
  min-height: 48px;
}

#passwordScreen button {
  padding: 14px 30px;
  border: none;
  border-radius: 8px;
  background: #2563eb;
  color: #fff;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: all 0.3s;
  min-height: 48px;
  min-width: 120px;
}

#passwordScreen button:active {
  background: #3b82f6;
  transform: scale(0.95);
}

#errorMsg {
  color: #ff4d4d;
  margin-top: 10px;
  display: none;
  font-size: 0.9rem;
  font-weight: 600;
}

/* Fillout Button */
.fillout-container {
  text-align: center;
  margin: 15px 0;
  padding: 0 15px;
}

/* Media Queries for Different Screen Sizes */
@media (max-width: 480px) {
  .container {
    grid-template-columns: 1fr;
    gap: 15px;
    padding: 15px 10px;
  }
  
  .card {
    padding: 15px;
  }
  
  .card img {
    width: 80px;
    height: 80px;
  }
  
  .modal-content {
    padding: 15px;
    max-width: 98vw;
  }
  
  .controls-row {
    flex-direction: column;
    gap: 10px;
  }
  
  .header {
    padding: 15px 10px;
    gap: 10px;
  }
  
  .header .logo {
    height: 60px;
    width: 60px;
  }
}

@media (min-width: 768px) and (max-width: 1024px) {
  .container {
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }
  
  .modal-content {
    max-width: 90vw;
  }
}

@media (min-width: 1025px) {
  .container {
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 25px;
  }
  
  .card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 12px 24px rgba(0,0,0,0.2);
  }
  
  .card img:hover {
    transform: scale(1.1);
  }
  
  .modal-actions button:hover {
    background: #3b82f6;
    transform: scale(1.05);
  }
  
  .close:hover {
    color: #b91c1c;
  }
}

/* Touch Device Optimizations */
@media (hover: none) and (pointer: coarse) {
  .card:hover {
    transform: none;
  }
  
  .modal-actions button:hover {
    transform: none;
  }
}

/* Prevent zoom on input focus for iOS */
@media screen and (max-width: 768px) {
  input, select, textarea {
    font-size: 16px !important;
  }
}
</style>
</head>
<body>

<!-- Password Overlay -->
<div id="passwordScreen">
  <div class="password-container">
    <div class="password-header">
      <div style="text-align: center;">
        <img class="password-logo" 
             src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg2uoDdiCRQlbsyEYYACg2oAtkXr0VCXFRJi3vsEtKoOy4RA5mqlA04784903v09kSCp3YTV2vzJBsIaK0NnpKdtoVgT8vY4btXjxtfWRhUP-VzFL8KkColwJaTD9Pb9jq3cW_wdrlkx69s9MGDX3VMyjqlZS3xmIJfzLW4tz97eTf7ecDpgP_gnOZDwT8/s1024/1000038009.png" 
             alt="Gurudayal Govt. College Rover Scout Group Logo">
        <p style="margin: -5px 0 0; font-size: 6px; color: #004d00;">EIIN-110496</p>
      </div>
      <div class="password-title">
        <h1>Gurudayal Govt. College Rover Scout Group</h1>
        <p style="font-size: 5px;
  margin: 2px 0 0 0;">4th November - 1977</p>
      </div>
    </div>

    <div style="margin-top: -10px;" id="pulsing-fillout" 
         data-fillout-id="wqKCAzmCe8us" 
         data-fillout-embed-type="popup" 
         data-fillout-button-text="‡¶≠‡¶∞‡ßç‡¶§‡¶ø ‡¶´‡¶∞‡¶Æ ‡¶ñ‡ßÅ‡¶≤‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®"
         data-fillout-dynamic-resize 
         data-fillout-button-size="medium"
         data-fillout-inherit-parameters 
         data-fillout-popup-size="medium">
    </div>

    <h2 style="margin-top: 10px;">‡¶∏‡¶ï‡¶≤ ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡ßü‡ßá Enter ‡¶ö‡¶æ‡¶™‡ßÅ‡¶®</h2>
    <p>Enter the password to continue</p>
    <p style="font-size:12px; color: red; text-align:center; margin:5px 0;">
      Only for Seniors and Leaders
    </p>

    <input type="password" id="passwordInput" placeholder="Password" autocomplete="current-password">
    <button onclick="checkPassword()">Enter</button>
    <p id="errorMsg">Wrong password!</p>
    
    <div class="crsg-footer" style="margin-top: 30px; padding: 15px; background: rgba(15, 23, 42, 0.4); border-radius: 10px; color: #e2e8f0;">
      <p style="margin:0; font-size: 14px; line-height:1.4;">
        ¬© <span id="crsg-year"></span> | All Rights Reserved <br>
        <a href="https://www.facebook.com/groups/gdcrover/?ref=share&mibextid=NSMWBT" target="_blank" 
           style="color:#38bdf8; text-decoration:none; font-weight:500;">
          Gurudayal Govt. College Rover Scout Group
        </a>
      </p>

      <div class="crsg-dev" style="margin-top:12px; display:flex; align-items:center; justify-content:center; gap:10px;">
        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhCDeXufBywGlGcvjFv5OaZNnGnIFboYZgUyo9NPcDt7SH5dWhG6Kv7wOtGMm5uBfA-2RCI41U0IWscQhEPQ9_6mHg192N68FaFDDE4HIfb8zXw6Ubafj329ToS6mYTqHo8Wu8aRidwjczDQZ4Id_t7K-E32b8ZthoHTIH3r86pWwfOmFdNvgcQOOeHBDc/s2000/1000038033.png" 
             alt="Developer"
             style="width:36px; height:36px; border-radius:50%; object-fit:cover; border:1px solid #38bdf8;">
        <div style="text-align:left; font-size:11px; line-height:1.3;">
          <strong style="color:#38bdf8;">Developed by</strong><br>
          Md. Ashfaqur Rahman Tanim
          <div style="font-size:10px; color:#94a3b8;">Rover Mate (Unit-3)</div>
        </div>
      </div>
    </div>
  </div>
</div>

<header class="header">
  <img class="logo" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg2uoDdiCRQlbsyEYYACg2oAtkXr0VCXFRJi3vsEtKoOy4RA5mqlA04784903v09kSCp3YTV2vzJBsIaK0NnpKdtoVgT8vY4btXjxtfWRhUP-VzFL8KkColwJaTD9Pb9jq3cW_wdrlkx69s9MGDX3VMyjqlZS3xmIJfzLW4tz97eTf7ecDpgP_gnOZDwT8/s1024/1000038009.png" alt="C Logo">
  <div>
    <h1>Gurudayal Govt. College Rover Scout Group - ‡¶≠‡¶∞‡ßç‡¶§‡¶ø ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®</h1>
    <p>üåü"‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø, ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶∂‡¶æ, ‡¶Ö‡¶∏‡ßÄ‡¶Æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶¨‡¶®‡¶æ!"üåü</p>
  </div>
</header>

<div class="controls-container">
  <div class="controls-row">
    <div class="total-badge" id="totalBadge">‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®: 0</div>
    <button id="refreshBtn">üîÑ</button>
  </div>
  
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="üîç ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®...">
  </div>
</div>

<div class="fillout-container">
  <div data-fillout-id="wqKCAzmCe8us"
       data-fillout-embed-type="popup"
       data-fillout-button-text="‡¶≠‡¶∞‡ßç‡¶§‡¶ø ‡¶´‡¶∞‡¶Æ ‡¶ñ‡ßÅ‡¶≤‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®"
       data-fillout-dynamic-resize
       data-fillout-button-size="medium"
       data-fillout-inherit-parameters
       data-fillout-popup-size="medium">
  </div>
</div>

<div class="container" id="cardsContainer"></div>

<div class="modal" id="profileModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modalName" style="font-size: clamp(1.2rem, 4vw, 1.5rem);"></h2>
      <span class="close" onclick="closeModal()">&times;</span>
    </div>

    <div class="modal-actions">
      <button onclick="copyInfo()">Copy Info</button>
      <button onclick="downloadInfoImg()">Download Info Image</button>
    </div>

    <div class="table-container">
      <div id="modalDetails"></div>
    </div>
  </div>
</div>

<div class="footer">
  <p>¬© <span id="year"></span> | All Rights Reserved <br>
    <a href="https://www.facebook.com/groups/gdcrover/?ref=share&mibextid=NSMWBT" target="_blank">
      Gurudayal Govt. College Rover Scout Group
    </a>
  </p>
  <div class="developer">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhCDeXufBywGlGcvjFv5OaZNnGnIFboYZgUyo9NPcDt7SH5dWhG6Kv7wOtGMm5uBfA-2RCI41U0IWscQhEPQ9_6mHg192N68FaFDDE4HIfb8zXw6Ubafj329ToS6mYTqHo8Wu8aRidwjczDQZ4Id_t7K-E32b8ZthoHTIH3r86pWwfOmFdNvgcQOOeHBDc/s2000/1000038033.png" alt="Developer">
    <div>
      <strong>Developed by</strong><br>
      Md. Ashfaqur Rahman Tanim
      <p style="font-size:11px; margin:2px 0;">Rover Mate (Unit-3)</p>
      <p style="font-size:9px; margin:0;">Gurudayal Govt. College Rover Scout Group</p>
    </div>
  </div>
</div>

<script src="https://server.fillout.com/embed/v1/"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
document.getElementById("year").textContent = new Date().getFullYear();
document.getElementById("crsg-year").textContent = new Date().getFullYear();

const sheetURL = "https://docs.google.com/spreadsheets/d/1xUqDLo96syqjPIfzaTR5UnL47XCYW4iVpTF9YURB6EY/export?format=tsv";
let allData = [];
let headers = [];

// Enhanced touch and mobile support
function setupTouchEvents() {
  // Prevent double tap zoom
  let lastTouchEnd = 0;
  document.addEventListener('touchend', function (event) {
    const now = (new Date()).getTime();
    if (now - lastTouchEnd <= 300) {
      event.preventDefault();
    }
    lastTouchEnd = now;
  }, false);

  // Better touch feedback
  const cards = document.querySelectorAll('.card');
  cards.forEach(card => {
    card.addEventListener('touchstart', function() {
      this.style.transform = 'scale(0.98)';
    });
    
    card.addEventListener('touchend', function() {
      this.style.transform = 'scale(1)';
    });
  });
}

async function loadData() {
  try {
    const response = await fetch(sheetURL);
    const text = await response.text();
    const rows = text.trim().split("\n").map(r => r.split("\t"));
    headers = rows[0];
    allData = rows.slice(1);
    renderCards(allData);
    setupTouchEvents();
  } catch (error) {
    console.error('Error loading data:', error);
    document.getElementById("totalBadge").textContent = "‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!";
  }
}

function renderCards(data) {
  const container = document.getElementById("cardsContainer");
  container.innerHTML = "";
  
  if (data.length === 0) {
    container.innerHTML = `
      <div style="grid-column: 1/-1; text-align: center; padding: 40px 20px; color: #64748b;">
        <h3 style="margin-bottom: 10px;">‡¶ï‡ßã‡¶®‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</h3>
        <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Æ‡¶ø‡¶≤‡ßá ‡¶è‡¶Æ‡¶® ‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>
      </div>
    `;
    return;
  }
  
  data.forEach(row => {
    const obj = {};
    headers.forEach((h, i) => obj[h] = row[i]);
    const photo = obj["‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø"] || "https://via.placeholder.com/90";
    const name = obj["‡¶®‡¶æ‡¶Æ (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡ßü)"] || "‡¶®‡¶æ‡¶Æ ‡¶®‡ßá‡¶á";
    const formNo = obj["‡¶´‡¶∞‡¶Æ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞"];
    const mobile = obj["‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞"]?.slice(-11);
    const email = obj["Your email"];
    const className = obj["‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø"];
    const year = obj["‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶¨‡¶∞‡ßç‡¶∑"];
    const collegeId = obj["‡¶ï‡¶≤‡ßá‡¶ú ‡¶Ü‡¶á‡¶°‡¶ø ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞"];
    const dept = obj["‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó"];
    
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${photo}" alt="${name}" loading="lazy">
      <h3>${name}</h3>
      ${formNo ? `<p><span class="label">Form No:</span> ${formNo}</p>` : ""}
      ${mobile ? `<p><span class="label">Mobile:</span> <a href="tel:${mobile}" class="clickable-link">${mobile}</a></p>` : ""}
      ${email ? `<p><span class="label">Email:</span> <a href="mailto:${email}" class="clickable-link">${email}</a></p>` : ""}
      ${className ? `<p><span class="label">Class:</span> ${className}</p>` : ""}
      ${year ? `<p><span class="label">Academic Year:</span> ${year}</p>` : ""}
      ${collegeId ? `<p><span class="label">College ID:</span> ${collegeId}</p>` : ""}
      ${dept ? `<p><span class="label">Division:</span> ${dept}</p>` : ""}
    `;
    
    card.addEventListener('click', () => showProfile(obj, name));
    container.appendChild(card);
  });
  
  document.getElementById("totalBadge").textContent = "‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®: " + data.length;
}

function showProfile(obj, name) {
  const modal = document.getElementById("profileModal");
  document.getElementById("modalName").textContent = name;
  let table = "<table>";
  
  for (const [key, value] of Object.entries(obj)) {
    if (value && key !== "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø" && !key.includes("‡¶ú‡¶®‡ßç‡¶Æ ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶®")) {
      let displayValue = value;
      
      // Enhanced link detection for mobile
      if (typeof value === 'string') {
        // Detect URLs
        if (value.match(/https?:\/\/[^\s]+/)) {
          displayValue = `<a href="${value}" target="_blank" class="clickable-link">${value}</a>`;
        }
        // Detect phone numbers (Bangladeshi format)
        else if (value.match(/(?:\+88)?01[3-9]\d{8}/)) {
          const cleanNumber = value.replace(/\D/g, '').replace(/^88/, '');
          displayValue = `<a href="tel:${cleanNumber}" class="clickable-link">${value}</a>`;
        }
        // Detect WhatsApp numbers
        else if ((key === "WhatsApp number" || key.toLowerCase().includes("whatsapp")) && value.match(/\d+/)) {
          const cleanNumber = value.replace(/\D/g, '');
          displayValue = `<a href="https://wa.me/${cleanNumber}" target="_blank" class="clickable-link whatsapp-link">${value} üí¨</a>`;
        }
        // Detect email addresses
        else if (value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
          displayValue = `<a href="mailto:${value}" class="clickable-link">${value}</a>`;
        }
      }
      
      table += `<tr><th>${key}</th><td>${displayValue}</td></tr>`;
    }
  }
  table += "</table>";
  document.getElementById("modalDetails").innerHTML = table;
  modal.style.display = "flex";
  
  // Add touch event to close modal when clicking outside
  modal.addEventListener('click', function(e) {
    if (e.target === modal) {
      closeModal();
    }
  });
}

function closeModal() { 
  document.getElementById("profileModal").style.display = "none"; 
}

// Enhanced search with debouncing
let searchTimeout;
document.getElementById("searchInput").addEventListener("input", function() {
  clearTimeout(searchTimeout);
  const query = this.value.toLowerCase();
  searchTimeout = setTimeout(() => {
    const filtered = allData.filter(row => row.some(col => col && col.toLowerCase().includes(query)));
    renderCards(filtered);
  }, 300);
});

/* --- Password Protection --- */
const passwordScreen = document.getElementById("passwordScreen");
const passwordInput = document.getElementById("passwordInput");
const errorMsg = document.getElementById("errorMsg");

async function fetchPassword() {
  try {
    const response = await fetch("https://docs.google.com/spreadsheets/d/1AS0Per8BEnw2grNf7XZeZuWDIFx_Z2u7pW7gnXwgAsk/export?format=tsv");
    const text = await response.text();
    const rows = text.trim().split("\n");
    const passwordRow = rows[1].split("\t");
    const password = passwordRow[0];
    return password.trim();
  } catch (error) {
    console.error("Error fetching password:", error);
    return null;
  }
}

async function checkPassword() {
  const storedPassword = await fetchPassword();
  
  if (storedPassword && passwordInput.value === storedPassword) {
    passwordScreen.style.display = "none";
    loadData();
  } else {
    errorMsg.style.display = "block";
    passwordInput.value = '';
    setTimeout(() => {
      errorMsg.style.display = "none";
    }, 3000);
  }
}

passwordInput.addEventListener("keypress", function(e){
  if(e.key === "Enter") checkPassword();
});

// Enhanced refresh button
document.getElementById("refreshBtn").addEventListener("click", async () => {
  const badge = document.getElementById("totalBadge");
  const originalText = badge.textContent;
  badge.textContent = "‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
  
  try {
    await loadData();
    // Show success feedback
    badge.style.background = "linear-gradient(135deg, #10b981, #34d399)";
    setTimeout(() => {
      badge.style.background = "linear-gradient(135deg, #2563eb, #3b82f6)";
    }, 2000);
  } catch(err) {
    badge.textContent = "‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•!";
    badge.style.background = "linear-gradient(135deg, #ef4444, #f87171)";
    setTimeout(() => {
      badge.textContent = originalText;
      badge.style.background = "linear-gradient(135deg, #2563eb, #3b82f6)";
    }, 3000);
    console.error(err);
  }
});

/* --- Copy and Download Info --- */
function copyInfo() {
  const details = document.getElementById("modalDetails").innerText;
  navigator.clipboard.writeText(details).then(() => {
    alert("‚úÖ ‡¶∏‡¶ï‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
  }).catch(err => {
    alert("‚ùå ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!");
  });
}

function downloadInfoImg() {
  const modalContent = document.querySelector(".modal-content");
  const downloadBtn = document.querySelector('.modal-actions button:last-child');
  const originalText = downloadBtn.textContent;
  
  downloadBtn.textContent = "‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
  downloadBtn.disabled = true;
  
  html2canvas(modalContent, { 
    scale: 2,
    useCORS: true,
    logging: false
  }).then(canvas => {
    const link = document.createElement("a");
    link.download = `${document.getElementById("modalName").textContent || 'info'}.png`;
    link.href = canvas.toDataURL("image/png");
    link.click();
    
    downloadBtn.textContent = originalText;
    downloadBtn.disabled = false;
  }).catch(err => {
    alert("‚ùå ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•!");
    downloadBtn.textContent = originalText;
    downloadBtn.disabled = false;
  });
}

// Initialize the app
document.addEventListener('DOMContentLoaded', function() {
  // Prevent context menu on long press
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    return false;
  });
});
</script>

</body>
</html>
